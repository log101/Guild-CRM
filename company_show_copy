<style>
</style>

<h1>Company: <%= @company.name %></h1>
<h2>Owner of the company <%= User.find(@company.owner_id).username %>

<!-- #Show companies tags -->
<div id="company_tags">
	<h3>You company has tagged as:</h3>
	<ul>
		<% @company.tags.each do |tag| %>
			<% if @company.errors.any? && tag.body == @tag.body %>
				<% next %>
			<% else %>
				<li><%= tag.body %> <%= link_to '|delete tag|', [tag.company, tag] , 
					method: :delete %> </li>
			<% end %>
		<% end %>
	</ul>
</div>

<!-- Add a new tag form, show if there is an error -->
<h3>Add a new tag</h3>
<% if @new_tag %>
	<% if @new_tag.errors.any? %>
		<div id="company_tag_error_explanation">
			<ul>
				<% @new_tag.errors.full_messages.each do |msg| %>
					<li><%= msg %></li>
				<% end %>
			</ul>
		</div>
	<% end %>
<% end %>
<!-- New company tag form -->
<%= form_with scope: :tag, url: company_tags_path(@company.id), local: true do |form| %>
	<p>
	<%= form.label :body %>
	<%= form.text_field :body %>
	<%= form.submit "Add" %>
	</p>
<%end%>


<!-- list company workers -->
<% if @workers != nil && @workers.count != 0%>
	<h3>Members : </h3>
	<ul>
		<% @workers.each do |w|  %>
			<li>
				<% worker = User.find(w.user_id) %>
				<%= worker.username %>
				<%= link_to "remove", [@company, w], method: :delete %>
			</li>
		<%end%>
	</ul>
<% else %>
	<h3>You dont have any member </h3>
<% end %>


<!-- See errors when sending a new invitation -->
<% if @invitation %>
	<% if @invitation.errors.any? %>
		<div id="invitation_error_explanation">
			<ul>
				<% @invitation.errors.full_messages.each do |msg| %>
					<li><%= msg %></li>
				<% end %>
			</ul>
		</div>
	<% end %>
<%end%>

<!-- New invitation form -->
<h5>Add new workers</h5>
<%= form_with scope: :company, url: company_invitations_path(@company.id), local: true do |form| %>
	<%= form.label :email %>
	<%= form.text_field :email %>
	<%= form.submit "Add" %>
<% end %>
<!-- list company contacts -->
<% if @company_contacts != nil && @company_contacts.count != 0%>
	<h3>Companies : </h3>
	<ul>
		<% @company_contacts.each do |c|  %>
			<li>
				<%= c.website %>
				<%= link_to "remove", company_contact_path(@company, c, type: "company"), method: :delete %>
			</li>
		<%end%>
	</ul>
<% end %>

<!-- list user contacsts -->
<% if @user_contacts != nil && @user_contacts.count != 0%>
	<h3>Users : </h3>
	<ul>
		<% @user_contacts.each do |c|  %>
			<li>
				<%= c.name %>
				<%= link_to "remove", company_contact_path(@company, c), method: :delete %>
			</li>
		<%end%>
	</ul>
<% end %>
<!-- See errors when adding a new contact -->
<% if @new_contact %>
	<% if @new_contact.errors.any? %>
		<div id="invitation_error_explanation">
			<ul>
				<% @new_contact.errors.full_messages.each do |msg| %>
					<li><%= msg %></li>
				<% end %>
			</ul>
		</div>
	<% end %>
<%end%>

<h2>Create a new contact!</h2>
<%= form_with scope: :company, url: company_contacts_path(@company.id),
	class: "p-3", local: true do |form| %>
	<div class="form-group">
		<label for="UserOrCompanyField">User or Company Contact ?</label>
		<%= form.select :option,
			options_for_select([["Company", "company"],
											 ["User","user"]]),{},
		{:class => "form-control", :id => "UserOrCompanyField"} %>	
</div>

<div class="form-group" id="UserFieldDiv">
	<div class="form-group">
		<%= form.label :username %>
		<%= form.text_field :username, class:"form-control", id:"UserName",
			placeholder:"Username" %>
		<%= form.label :email %>
		<%= form.text_field :email, class:"form-control", id:"Email",
			placeholder:"Email" %>
</div>
</div>

<div class="form-group" id="CompanyFieldDiv">
	<div class="form-group">
		<%= form.label :company_name, "Company Name" %>
		<%= form.text_field :company_name, class:"form-control", id:"CompanyName",
			placeholder:"Company Name"%>
		<%= form.label :website %>
		<%= form.text_field :website, class:"form-control", id:"Website",
			placeholder:"Website"%>
</div>
</div>
<button type="submit" class="btn btn-primary">Submit</button>
<% end %>
<script>
	$("#selected").prop("selected");
$('#UserFieldDiv').hide();	
$("#UserOrCompanyField").change(function() {
	if ($(this).val() == "company") {
		$('#UserFieldDiv').hide();
		$('#CompanyFieldDiv').show();
	} else {
		$('#UserFieldDiv').show();
		$('#CompanyFieldDiv').hide();
	}
});
$("#seeAnotherField").trigger("change");
</script>

<%= link_to "Return to User", User.find(@company.owner_id) %>
<%= link_to "DELETE Company", company_path(@company.id), method: :delete %>


